<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Мои заявки</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 0; padding: 0; }
        .container { max-width: 1200px; margin: 20px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden; }
        .navbar { display: flex; justify-content: space-around; background: #fafafa; border-bottom: 1px solid #ddd; }
        .navbar a { padding: 12px 20px; text-decoration: none; color: #333; font-weight: 500; }
        .navbar a.active { color: #007bff; border-bottom: 3px solid #007bff; }
        .navbar a:hover { background: #f0f0f0; }
        .content { padding: 20px; }
        h1 { margin: 0 0 20px; font-size: 1.4em; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px 12px; border-bottom: 1px solid #ddd; text-align: left; }
        th { background: #f0f0f0; }
        .no-data { text-align: center; color: #777; padding: 20px 0; }
        .btn-refresh { margin-bottom: 10px; padding: 6px 12px; background: #17a2b8; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        .btn-refresh:hover { background: #138496; }
        .highlight { color: red; }
    </style>
</head>
<body>

<div class="container">
    <nav class="navbar">
        <a href="/portfolio.html">Портфель</a>
        <a href="/markets.html">Рынки</a>
        <a href="/accounts.html">Мои счета</a>
        <a href="/orders.html" class="active">Мои заявки</a>
        <a href="/transactions.html">Мои транзакции</a>
    </nav>

    <div class="content">
        <h1>Мои заявки</h1>
        <button class="btn-refresh" onclick="loadOrders()">Обновить</button>
        <table id="ordersTable">
            <thead>
            <tr>
                <th>ID</th>
                <th>Тикер</th>
                <th>Тип</th>
                <th>Цена</th>
                <th>Комиссия</th>
                <th>Кол-во</th>
                <th>Доступно</th>
                <th>Статус</th>
                <th>Дата</th>
            </tr>
            </thead>
            <tbody>
            <tr><td colspan="9" class="no-data">загрузка...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<script>
    async function loadOrders() {
        const tbody = document.querySelector('#ordersTable tbody');
        tbody.innerHTML = '<tr><td colspan="9" class="no-data">загрузка...</td></tr>';
        try {
            const resp = await fetch('/api/orders/history');
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const list = await resp.json();
            if (list.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="no-data">У вас нет заявок</td></tr>';
                return;
            }
            tbody.innerHTML = '';
            list.forEach(o => {
                const tr = document.createElement('tr');
                // ID
                tr.innerHTML += `<td>${o.id}</td>`;
                // Тикер
                tr.innerHTML += `<td>${o.ticker}</td>`;
                // Тип
                tr.innerHTML += `<td>${o.orderType}</td>`;
                // Цена с подсветкой
                const priceCell = document.createElement('td');
                const price = parseFloat(o.price);
                const market = parseFloat(o.currentPrice);
                if (price > market * 1.5 || price < market * 0.5) {
                    priceCell.classList.add('highlight');
                }
                priceCell.textContent = price.toFixed(2);
                tr.appendChild(priceCell);
                // Комиссия
                tr.innerHTML += `<td>${parseFloat(o.fee).toFixed(2)}</td>`;
                // Количество
                tr.innerHTML += `<td>${o.quantity}</td>`;
                // Доступно
                tr.innerHTML += `<td>${o.availableQuantity}</td>`;
                // Статус
                tr.innerHTML += `<td>${o.status}</td>`;
                // Дата
                tr.innerHTML += `<td>${new Date(o.createdAt).toLocaleString('ru-RU')}</td>`;
                tbody.appendChild(tr);
            });
        } catch (err) {
            tbody.innerHTML = '<tr><td colspan="9" class="no-data">Ошибка загрузки заявок</td></tr>';
            console.error(err);
        }
    }

    window.addEventListener('DOMContentLoaded', loadOrders);
</script>
</body>
</html>